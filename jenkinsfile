/* groovylint-disable CompileStatic, GStringExpressionWithinString, LineLength, NestedBlockDepth, NoDef, VariableTypeRequired */
/* groovylint-disable-next-line CompileStatic */
// pipeline {
//     agent any

//     stages {
//         stage('CI - Build and Push Docker Image') {
//             steps {
//                 // Checkout code from GitHub
//                 git branch: 'feature/azurePipeline', url: 'https://github.com/kunalSinghQA/playwright.git'

//                 // Build Docker image
//                 script {
//                     def dockerImage = docker.build('kunalfeuji/playwrightapp/', '.')
//                     docker.withRegistry('https://registry.hub.docker.com', 'docker-hub-credentials') {
//                         // Push Docker image to Docker Hub
//                         dockerImage.push()
//                     }
//                 }
//             }
//         }

//         stage('CD - Deploy to Azure VM') {
//             steps {
//                 // Azure login using Azure CLI
//                 script {
//                     sh 'az login --service-principal -u <client-id> -p <client-secret> --tenant <tenant-id>'
//                 }

//                 // Access Azure VM and deploy Docker image
//                 script {
//                     sh 'az vm create -g <resource-group> -n <vm-name> --image <image-from-docker-hub> --admin-username <username> --admin-password <password>'
//                     // Use appropriate commands to pull and run the Docker image on the Azure VM
//                 }
//             }
//         }
//     }
// }
pipeline {
    agent any

    environment {
        // Define environment variables
        BASE_URL_API = 'https://bookcart.azurewebsites.net'
        USER_NAME = 'testUserBdd'
        USER_PASS = 'Test@123'
        // Add other environment variables as needed
    }

    stages {
        stage('Checkout') {
            steps {
                // Checkout code from GitHub
                git credentialsId: 'jenkins-github-ci-cd', url: 'https://github.com/ks1912/playwright.git', branch: 'feature/azurePipeline'
            }
        }

        stage('Set Environment') {
            steps {
                // Set environment variables for Node.js
                sh "export BASE_URL_API=${env.BASE_URL_API}"
                sh "export USER_NAME=${env.USER_NAME}"
                sh "export USER_PASS=${env.USER_PASS}"
                // Add other variable assignments as needed
            }
        }

        stage('Install Dependencies') {
            steps {
                // Install Node.js dependencies
                sh 'npm install'
            }
        }

        stage('Run Tests') {
            steps {
                // Run tests for your Node.js project
                sh 'BASE_URL_API=${env.BASE_URL_API} USER_NAME=${env.USER_NAME} npm run headless'
            }
        }

        // stage('Generate Report') {
        //     steps {
        //         // Generate report (replace these commands with your actual report generation steps)
        //         sh 'npm run generate-report'  // Example command
        //     }

        //     post {
        //         always {
        //             // Archive the generated report for later access
        //             archiveArtifacts artifacts: 'path/to/your/report/*', allowEmptyArchive: true
        //         }
        //     }
        // }
    }

    // // Additional post-build actions or notifications can be added here
    // post {
    //     success {
    //         // For example, send an email on successful build
    //         emailext(
    //             to: 'your@email.com',
    //             subject: 'Node.js Build Success',
    //             body: 'The Node.js build and tests have passed successfully.'
    //         )
    //     }
    // }
}
